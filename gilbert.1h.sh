#!/bin/bash

echo "| image=iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACUlBMVEUAAACKfGt5bmCZiXaThXIpJyhjWlGHemlyZ1tHQT3Uvp+FeWgKDRN2cnCcjHd+cmNjX1zHspSMf21taWeZiXZ8cWI3NTb////SvJ03NDP02rRSTk3//+kbGhqIhoZFQ0NeXFwbGRkfHR6DgYFubGwxLi++vb1UUVF+cmO1oomiknyrmoKgj3qkk32hkHuShHGdjXh0aV2Ie2rGsZXgx6b227bx17Ly2LPy17PexqXIs5aHemoAAABjWlHfyKbex6Z3bF5fV06GeWnnzqziyqh1al2Rg3Hu1bHnz6yBdWaEd2iYiXXSvJzUvZ2OgG57b2GOgG6mln+Dd2dnXlSvnoXy2bSZinZsY1fDr5Ool4AAAADMt5mvnYVBQEHItJixnoV9fHzDvripo5wvMDY5Nja0s7PMzc2cm5uop6fw7+/Rz892dXVkYmLU09O2uLifnp7j4+PT1dVAPj7/5b3/5L3/5Lz/5b7/5b3/5L3/5L3/5b3z2rbr07Ls1LP23LjUyr3QzMjU0c3XyrmyoIfpz6zXy7rLxb3Qy8TVx7TawqL84bvkzKrfyKfXwaLv1rL+4rzmzavjy6ndxqXw1rL227b/47z84Lrp0K3t07D+4rz43Lf+4rv/5L3/5r7/5r//5b353rfZyrbhzbHcx6jUvp/eyazYyLTT09PW1tbc29qZcXFNLy+fnJvV1dX9/f3t7e3c3NyibnF0MDS3sbHr5+fgzc7y8vL///////+wl5h5PkHDv7+OamzCRkzbw8Tc3NzasbO8OkGGbnAqJidlJirHoaNeKR0BAAAAc3RSTlMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIZJ6jHp9dlxZEzrO9v78/f303TsALuTkPgUx7uUkSPfsLkPL/vmlH335SB6u/pwWnWIFs3EUzYE/9LsMCpryVWr50iEa0XxU+sUO9wPtygAAAAFiS0dEFwvWmI8AAAAHdElNRQfeCwsSEwekGMLAAAAA+0lEQVQY02NgYGDU0NTS1tHV0zcwZGIAAWYjYxNTM3MLSytrFrAAq42tXXFJaZm9gyMbWICB3cm5vKKyysWVA8Ln5HJzr66prfPw5OYB8Xn5vLx96hsam3z9/PlBAgKCAc0trW3tHZ2BQUIgAWGR4JCu7p7evtCwcFGwGWLiEf0TJk6aPCVSAmKoZFT01GnTZ8ycFSMFEZCOjZs9Z+68+QviZWTBAnIJiQsXLV6ydFlSsjyIr5CSunzFylWr16xNSxdXZGBQEs/IXLd+w8ZNm7dszcpWZmBQycndtn3Hjp27du/Zuy9PXJVBLb9g/44dOw4cPHT4yNHCInUADVdPVRyFx6kAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTQtMTEtMTFUMTg6MTk6MDcrMDE6MDA6H7L5AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTExLTExVDE4OjE5OjA3KzAxOjAwS0IKRQAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII="
echo ---

RANDOM_DATE=$RANDOM%10000	# about numebr of days since epoch
RANDOM_DATE=$(( RANDOM_DATE * 86400 ))
FIRST_COMIC_DATE=608688000	#1989-04-16

NOW_COMIC_DATE=$(( FIRST_COMIC_DATE + RANDOM_DATE ))

NOW_COMIC_DATE_STRING=$(date -r $NOW_COMIC_DATE +'%Y-%m-%d')

GILBERT_COMIC_URL="http://dilbert.com/strip/$NOW_COMIC_DATE_STRING"

DATA_STRING=$(curl --silent $GILBERT_COMIC_URL | grep 'data-image')

DATA_IMAGE_VALUE=$(echo $DATA_STRING | sed 's/.*data-image="\(.*\)" data-date.*/\1/')

DATA_TITLE=$(echo $DATA_STRING | sed 's/.*data-title="\(.*\)" data-tags.*/\1/')

IMAGE=$(base64 <(curl --silent "$DATA_IMAGE_VALUE"))

echo "| image=$IMAGE"
echo ---
echo "$DATA_TITLE | size=14 href='$GILBERT_COMIC_URL'"

echo ---
echo "Refresh... | refresh=true"
